{{/* layouts/partials/list-pages-recursive-debug.html (fixed name & safe) */}}

<div class="menu-debug">
  {{ $dot := . }}
  {{/* Decide the context: if we were passed a section page use it, else try CurrentSection, else site root */}}
  {{ $context := $dot.CurrentSection }}
  {{ if not $context }}
    {{ if eq $dot.Kind "section" }}
      {{ $context = $dot }}
    {{ else }}
      {{ $context = $dot.Site.GetPage "/" }}
    {{ end }}
  {{ end }}

  <div class="debug-context">
    <strong>Context:</strong>
    {{ if $context.File }}
      <code>{{ $context.File.Path }}</code>
    {{ else }}
      <code>/ (site root or virtual)</code>
    {{ end }}
    — Kind={{ $context.Kind }} — RegularPages={{ len $context.RegularPages }} — Sections={{ len $context.Sections }}
  </div>

  {{/* ---------- PAGES: group by Weight and show each group's pages ---------- */}}
  <div class="debug-pages">
    <h4>Pages grouped by <code>Weight</code> (in this context)</h4>
    {{ $groups := $context.RegularPages.GroupBy "Weight" }}
    {{ if gt (len $groups) 0 }}
      {{ range $g := $groups }}
        <details>
          <summary>
            group.Key={{ printf "%q" $g.Key }} (as int={{ int $g.Key }}) — {{ len $g.Pages }} pages
          </summary>
          <ol>
            {{ range $p := $g.Pages.ByLinkTitle }}
              <li>
                {{ if $p.File }}<code>{{ $p.File.Path }}</code>{{ else }}<code>(no file)</code>{{ end }}
                — LinkTitle={{ printf "%q" $p.LinkTitle }} |
                Title={{ printf "%q" $p.Title }} |
                Params.weight={{ printf "%v" $p.Params.weight }} |
                .Weight={{ printf "%v" $p.Weight }} |
                Date={{ printf "%v" $p.Date }} |
                Lastmod={{ printf "%v" $p.Lastmod }} |
                Draft={{ printf "%v" $p.Draft }}
              </li>
            {{ end }}
          </ol>
        </details>
      {{ end }}
    {{ else }}
      <p><em>No pages in this context.</em></p>
    {{ end }}
  </div>

  {{/* ---------- SECTIONS: group by Weight and recurse ---------- */}}
  <div class="debug-sections">
    <h4>Sections grouped by <code>Weight</code> (in this context)</h4>
    {{ $sgroups := $context.Sections.GroupBy "Weight" }}
    {{ if gt (len $sgroups) 0 }}
      {{ range $g := $sgroups }}
        <details>
          <summary>
            section-group.Key={{ printf "%q" $g.Key }} (as int={{ int $g.Key }}) — {{ len $g.Pages }} sections
          </summary>
          <ol>
            {{ range $s := $g.Pages.ByLinkTitle }}
              <li>
                {{ if $s.File }}<code>{{ $s.File.Path }}</code>{{ else }}<code>(no file)</code>{{ end }}
                — LinkTitle={{ printf "%q" $s.LinkTitle }} |
                Title={{ printf "%q" $s.Title }} |
                Params.weight={{ printf "%v" $s.Params.weight }} |
                .Weight={{ printf "%v" $s.Weight }} |
                Sections={{ len $s.Sections }} |
                RegularPages={{ len $s.RegularPages }} |
                Draft={{ printf "%v" $s.Draft }}
                <div class="debug-child" style="margin-left:1.25rem; margin-top:.5rem;">
                  {{ partial "list-pages-recursive-debug.html" $s }}
                </div>
              </li>
            {{ end }}
          </ol>
        </details>
      {{ end }}
    {{ else }}
      <p><em>No subsections in this context.</em></p>
    {{ end }}
  </div>
</div>

