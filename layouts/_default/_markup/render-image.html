{{/*

The code block at the end works very well but does not deal with
inline images. I don't know if it is a problem. But here is what
I was doing before:

{{- if .IsBlock -}}
  {{- partial "respimg.html" (dict "ctx" . "alt" $.Text) -}}
{{- else -}}
  <img src="{{ .Destination | safeURL }}"
       {{- with .PlainText }} alt="{{ . }}"{{ end -}}
       {{- with .Title }} title="{{ . }}"{{ end -}}>
{{- end -}}
*/}}


{{/* 
  Simple Image Render Hook â€” delegates to partial "respimg"
  --------------------------------------------------------
  Responsibilities:
  - Extract Markdown parameters (alt, caption)
  - Locate the Hugo Page Resource
  - Pass everything to the "respimg" partial for processing
*/}}

{{- $alt := .Text | plainify -}}
{{- $caption := "" -}}
{{- if ne .Title "" -}}
  {{- $caption = .Title | $.Page.RenderString -}}
{{- end -}}

{{/* Locate the image resource (page bundle first, then static path) */}}
{{- $res := .Page.Resources.GetMatch .Destination -}}
{{- if not $res -}}
  {{- if .Page.File -}}
    {{- with resources.Get (path.Join .Page.File.Dir .Destination) -}}
      {{- $res = . -}}
    {{- end -}}
  {{- end -}}
{{- end -}}

{{/* Delegate everything to the partial */}}
{{ partial "respimg.html" (dict
  "Page" .Page
  "Resource" $res
  "Destination" .Destination
  "Alt" $alt
  "Caption" $caption
) }}
